git:
  depth: 5
language: node_js
cache: yarn

# https://github.com/nodejs/Release
node_js:
- '12'
- '11'
- '10'
- '8'
- '6'

script: |
  if [[ "$(node -pe process.version)" == v10.* ]]; then # Is latest LTS?
    npm run test:ci &&
    bash <(curl -s https://codecov.io/bash) -f coverage/tests/coverage-final.json
  else
    npm run testonly
  fi

jobs:
  include:
  - stage: deploy
    if: branch = master OR tag IS present
    script: echo "Deploying..."
    node_js: lts/*
    deploy:
    - provider: script
      script: npm run gitpublish
      skip_cleanup: true
      on:
        branch: master
    - provider: npm
      skip_cleanup: true
      on:
        branch: master
        tags: true
      email: ivan.goncharov.ua@gmail.com
      api_key:
        secure: c4qeYtN4p41iqGxJFczGGaKgVKXEhKeCUOLAsgweLRN2yCAextWpZDP5EGn3lKZdLtovMIGsyVmdF1HDTKsAk/aBfPYsyvRgUpjtCUfxz0N48O009Erzkz7ibRrXkhcHWAKyE/RJRNpEkn8f7XdkEgewP1rjoSYhINizNZijDIhUfKVq41OfNRJoIv5WOX9DaArSJESde0z/wASlxS0vM4nrt0qjUdnMK4Dm0KGcJKJEqu/LA0YbZHfjl90pjr87MQzsYV1LF14EAI2JVzincrlOlyF872vLbja6AmFcugWNlefDGroV9LvSJUdlRdhDzc9Sr7Z4zgydOyHG6mvXgp0t4dV2fiJVWuU+oJL/v5LZ6jNEkk3jH5xDjC2xB9P45gm93HHekZzf5R3LQh8lfmdiFlhFDMVfv+8+T+nm+rwE9edxc68IBTPRaIRwnvNMpLJ1vuseBfWf5B6CKR1YNQESz1eweNdVa8DrKqXzOsMVNh1/lMIB5rqT6J/C+XQJbmiaYso5tksgr0FmyFJ6I/NQX0IazRS4Ao7paIf+hdgogePI4G5U4MW3M6WUTP9J2hQkqiWmmbgYAXYoYmrvoEMUi85voUdBjoyJtSvIQSz2Ai8JvwX3mNyinzef2wd9xP1eyTEqfY5CgNS5GgScIarcW9kWpQXT9lU4qFtklGw=

notifications:
  irc:
    use_notice: true
    on_success: change
    on_failure: change
    skip_join: true
    channels:
    - chat.freenode.net#graphql
  slack:
    secure: G7fzaXoPI1cyyW7dlpQ8oG/ot73n4kE83HgbyK1iEN1YBfodsytVgh0jS+zB3DhhRAotS/VfGVz9Wj2Oo109U5w/FyxdMGuKvFan/0B/aAws1sPxLGWA5230u1wTKQCHAu17+yppFOODUu1ILDXaD2A//Wj5iru9M4NnKc1bO6VHkfBHPTLQLbdPHmorwuSH02Ocbh7K4XOWzXRxM6VrwamEn1KnyXGu2w3QdJUT31OjGEEdf6FUzvjwzFgXPhngCw5+enpwm71ljHDNu8YHhXvHtS4328O5pYQO8np7j653HNEqi+ZUiYEOWpwC8be1xHdvi/s32tPFZiCx28ZmDoCUrY744tpPtE6tzuncmSKB0Y3EjutdXBpxllNr5l5hpX5092G2MlpokFbv85J+E2ALcZYNYeFOqTYTKwTYkxK6B1x4amBNpM+FXgUhloK4BK9OT0Qh5SiQOsM8cZT0h6QP91n+REljtpugW3VbuIxq5OJAi42FYbHBC27pohhq6ohU1euZfobk9a7ZawnjoEUk1EZHXiJzYKY/QqzyB6dwk0ersBl3l3OX/wnjwKTkqc9aTmDWo2L+lHaUCXuCY1+KQXsRicfnH395szTJXQbvcbN0zz188gdz6sawzi5BxndWo0NRwZyOG2YcyUHFQR4bK1rL7Lo6t6rijQ/XMeQ=

env:
  global:
    secure: uUjOV39iCLSLtShQfKk9AelIu2PqyKf8dYu4rqVcL5Y9yCHdds1KYysVgCx9XhndrugHNCXWzT/sKDS8voc/NRsfycnvdCIvu+dtBwf9lCHGcMyABFpvsjQfKTGyMCbYNDO8Hd/OQqHCFVj1lh4aNGev8tGqpJoMEDPdQbDKsvMVKWfo9QraXYYK7yh7U2vbidAV+YBj/e3VFfR2UQ+OECHxyxFGxWMbyTF8qRZ7JUsgCaJ82zrx0A7VoEJ6BeXxzhYDPuh3QTON9bXiJpWR/QcsKZNQ7d6Dxf06yo4XQDU9igxe6qst41Hj3IiZzLCyucoPXvoRsbmUcsAVdF4PWq3fnHUmyjRwOMcTjPd2SM4FPJpwnSGZEpstzKSJ3pDzpgRGsF7ai5nGNCes6RCi4AUf96GTjt0JAD+AXwD7mrGlcn4oi0m6r1GcNhDOFsBEgFqz26FXUFQcAqrHzZvsqvG01Cs5pAFMUIEpCyCrkDKClc/LWjJoVInDEVCwGqZk6Qz2XroYjFs25m+aB3ycSIN1qgkTg6szMO76tds4YtL8JDHaAXDbvXAk8YRYbQCAIFQVaIpkp8R1kJa++dP8Q3j/lwAkz+57XJ5KPRlLh7KMqF1joTGKptA0c2vD0sees2RxPrcZGmp6eaOLy3JhQmXfPaRLLpiK+plz6T25f7Y=
